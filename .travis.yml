services:
  - docker
env:
  - DOCKER_COMPOSE_VERSION=1.23.2
before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo chmod 777 ./docker/db/postgres-setup.sh
  - sudo mv docker-compose /usr/local/bin
  - docker --version
script:
  - docker-compose build db
  - docker-compose build static-analysis
  - docker-compose build test-postgresql
  - docker-compose run test-postgresql
  - docker-compose run static-analysis
# services:
#   - docker
# env:
#   global:
#     - DOCKER_COMPOSE_VERSION=1.23.2
#     - secure: uNl8l7/Mh6RzQ2SYb5Jws3wSXz1f6XaS6XQu5lBCf/VERqzBqTlKyROJOm08EFEPCuxA7c4FdRo/rtyzjLujf2kPJ+SWowRBsCf1LXuydOv00T7vS1hIsDrwEYCCvYJ1ide4Su00OoycJ5LEGt8eU3ETqgYrTiUbkGjRfa3LB7VOZV11ozhwHe/MQfRWq5NkzG+HXyJ6DVpzAr9DJpsP6SuaMh44X66zHsq1A1cJh5LfV9pgJkwyAWi9seO5n6lKuZh2SwsovQlVZIGsvYJR0rWl3xSD/8oV9MEIrTyvADGnbpQSI+o7NoFjrLCEIKiSuFc2wacI0XqbbYevXf/lZfs/j4nXk+mZ3GUX8ObnCJFDWl9a9JCcgR+uZVL8KuTwiBSToLXevlSmIenRhBI8vcE5oZcp+CzgFdlKwaqd1W0K5eWhw434Uqksh8tNnqxRILZ6hIJgb985O7UvY+N5qonQAyUNbo7T919WdR4UvL0vaB6puBmhlfCpQ93demDwvQySKnn8E9YnomClVS91BBFXB1k4P8LjQwmWqe51eHkN1YunRKzHnZd9RLH6HIQilqzq4oy2XIq+BzYlxDQWEoAuhe/B9mwVJrMQS/+wLx5ufmsKvf141BXNBLufWSz9GmPqpnvOq1C3vvBL7BjEXaPUfy/xwpbNU/56SrRf/8g=
#     - secure: AZGhwGMHp/KPc2Reyt9GJiddsp5X2+JaNJCb/c7kRGiJuh/DhXbM7wSMH5LGq12sRwv74Enpx2vAkf+NtWGwjQp3CpB8UrW/cYVymyqKST0/WJ4cbC6aU+Mmz+9aHZRp7mU6c0yxfKHuoyka3mYpmBkZ+HalP4bEA19gub4vuTxB0ZbsG+uCXvigyUDlHEii6oDtgj84BubT1fcSpdWK+bTz4gaMajcpOQhEa5A/yagIBopAmWZE53NWKeZDB8c4phFBxIgSSs48abUCgtcQChIG52hneL4RqheH+/75MFtlN+GdKNtn8/LesWIdSU+FBrd8N6/UO/ObIWMpLIORZjJZ2mf/xjhgetsBgS5iuMRLStwjvCi7RdzmS7JkcEckbhLXLce+jeUP0FO58l5l86XWOePSVqMFciCrqaeDBDDb5Gx8kj1jFLYeZSydlczx1siL5YjPRDNSisSRXEbZahFpkZMkbWwHFhsHLwTx64dqrGVjhdVyTHxtyywyAQRsiABtt1rn4jL958dkh78+Satj806fopzvG3q0mSObYKdtyuLl9aKGTTipiebPYdWPslM/2V6bHSAUm3PONeFe89HIQHVVpqEwcJTezfjiZCnKLLCuMSWJ2AGEyspUnIB4PdMxyrx1eoPq5fS5heLca6X1HudE8jDzXXNaXxqsCsI=
# before_install:
#   - sudo rm /usr/local/bin/docker-compose
#   - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
#     -s`-`uname -m` > docker-compose
#   - chmod +x docker-compose
#   - sudo mv docker-compose /usr/local/bin
#   - docker --version
#   - docker-compose version
#   - echo "Login into Docker Hub"
#   - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
#   - export GIT_SHA=`git rev-parse --short HEAD`
#   - echo "Building commit $GIT_SHA"
# jobs:
#   include:
#     - stage: tests
#       name: Unit Tests
#       script:
#         - cd ch4
#         - docker-compose build db
#         - docker-compose build test-postgresql
#         - docker-compose run test-postgresql
#     - stage: tests
#       name: Static Analysis
#       script:
#         - cd ch4
#         - docker-compose build static-analysis
#         - docker-compose run static-analysis
#     - stage: push
#       script:
#         - cd ch4
#         - docker-compose build server
#         - docker tag thoughts_server:latest jaimebuelta/thoughts-backend:$GIT_SHA
#         - docker push jaimebuelta/thoughts-backend:$GIT_SHA
#         - docker tag thoughts_server:latest jaimebuelta/thoughts-backend:$TRAVIS_BRANCH
#       deploy:
#         - provider: script
#           script: docker push jaimebuelta/thoughts-backend:$TRAVIS_BRANCH
#           on:
#             branch: master
#         - provider: script
#           script: docker push jaimebuelta/thoughts-backend:$TRAVIS_TAG
#           on:
#             tags: true
